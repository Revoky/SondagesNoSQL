<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ poll.name }}</title>
    <link rel="stylesheet" href="../static/main.css">
</head>
<body>

<form id="responseForm">
    {% for question in poll.questions %}
        <div class="question-response">
            <p><strong>{{ question.title }}</strong> ({{ question.type }})</p>
            {% if question.type == 'qcm' %}
                {% for reponse in question.reponses %}
                    <label>
                        <input type="radio" name="response_{{ question._id }}" value="{{ reponse }}" required>
                        {{ reponse }}
                    </label>
                {% endfor %}
            {% else %}
                <input type="text" name="response_{{ question._id }}" required>
            {% endif %}
        </div>
    {% endfor %}
    <button type="submit">Envoyer</button>
</form>

<script>
    document.getElementById("responseForm").addEventListener("submit", function(event) {
        event.preventDefault();
        
        const formData = new FormData(event.target);
        const responses = [];
    
        formData.forEach((value, key) => {
            responses.push({ question_id: key.replace("response_", ""), answer: value });
        });
    
        fetch("/sondages/{{ poll._id }}/answer", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ responses })
        })
        .then(response => response.json())
        .then(data => alert(data.message))
        .catch(error => alert("Erreur: " + error));
    });
    </script>
    

</body>
</html>
